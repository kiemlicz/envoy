{% set foreman_discovered_interfaces = salt['pillar.get']('foreman_interfaces', default=[{'ip':"127.0.0.1"}])|map(attribute='ip')|list %}
{% set interface = salt['pillar.get']('redis:settings:interfaces', default=foreman_discovered_interfaces)|first %}
{% set port = salt['pillar.get']('redis:settings:port', default="6379") %}

{% set redis = salt['grains.filter_by']({
    'Debian': {
        'name': 'redis',
        'pkg_name': 'redis-server',
        'service': 'redis',
        'user': 'redis',
        'config': 'salt://redis/server/redis.conf',
        'init': 'salt://redis/server/redis.service',
        'init_location': '/lib/systemd/system/redis@.service',
        'host': interface,
        'port': port,
    },
}, merge=salt['pillar.get']('redis')) %}
