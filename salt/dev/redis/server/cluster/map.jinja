{% from "redis/server/single/map.jinja" import redis as redis_single with context %}

{# host_id == hostname by default #}
{% set host_id = salt['grains.get']('id') %}

{% set redis = salt['grains.filter_by']({
    'Debian': {
        'total_slots': 16384,
        'masters': [{
          'id': host_id,
          'ip': '127.0.0.1',
          'port': 6379,
        }],
        'slaves': [{
          'id': host_id,
          'master_id': host_id,
          'master_ip': '127.0.0.1',
          'master_port': 6379,
          'ip': '127.0.0.1',
          'port': 6380,
        }],
    },
}, merge=salt['grains.filter_by']({
       'systemd': {
         'init_location': '/lib/systemd/system/redis@.service',
       }
     }, grain='init', merge=salt['pillar.get']('redis'))) %}

{% do redis.update(redis_single) %}
