language: python

sudo: required

dist: trusty

services:
  - docker

stages:
  - build
  - test
  - publish

#env:
#  global:
#    - SALT_VER="" # latest
#  matrix:
#    - DOCKER_IMAGE=debian-sid
#    - DOCKER_IMAGE=debian-stretch
#    - DOCKER_IMAGE=ubuntu-xenial
#    - DOCKER_IMAGE=ubuntu-bionic
#    - DOCKER_IMAGE=fedora-29

matrix:
  fast_finish: true
  allow_failures: # only unstable distro-based tests are allowed to fail
    - env: DOCKER_IMAGE=debian-sid

jobs:
  include:
    - env:
        - DOCKER_IMAGE=debian-sid
        - DOCKER_IMAGE=debian-stretch
    - stage: build
      name: "Build"
      script: .travis/prepare.sh
    - stage: test
      name: "Test"
      script:
        - while sleep 9m; do echo "=====[ $SECONDS seconds still running ]====="; done &
        - .travis/test.sh
        - kill %1
    - stage: publish
      name: "Publish"
      script: .travis/publish.sh
